<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/b42ee275af96bf75.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-9edee2920554d0a5.js"/><script src="/_next/static/chunks/4bd1b696-dc95eb63a9e79f5d.js" async=""></script><script src="/_next/static/chunks/517-5752a921451f8aa5.js" async=""></script><script src="/_next/static/chunks/main-app-fae9f1d243c67c3a.js" async=""></script><script src="/_next/static/chunks/932-8bfdd8b6c3b22a28.js" async=""></script><script src="/_next/static/chunks/app/blogs/streaming-json/page-19131ed480d1c870.js" async=""></script><title>Medhavi Monish</title><meta name="description" content="AI Blacksmith forging intelligence from scratch"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><base href="./"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="relative min-h-screen bg-cover bg-center bg-no-repeat bg-fixed" style="background-image:url(&#x27;/images/bg-home.png&#x27;)"><div class="bg-black/70 min-h-screen"><main class="relative min-h-screen bg-cover bg-center bg-no-repeat bg-fixed flex justify-center items-start py-20 px-4" style="background-image:url(&#x27;/images/bg-home.png&#x27;)"><div class="w-full max-w-4xl bg-black/80 text-white p-10 rounded-xl shadow-md"><a class="text-sm text-gray-400 hover:text-white transition block mb-4" href="/">← Back to Home</a><h1 class="text-4xl font-bold text-ember mb-2"><a target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline text-base block mb-2" href="https://github.com/MedhaviMonish/Stream-JSON">🔗 View on GitHub</a>Streaming JSON While Streaming from LLM</h1><p class="mb-6 leading-relaxed">When generating structured responses from LLMs, streaming JSON is almost impossible. JSON parsing requires strict syntax — every quote, comma, and bracket must be perfectly placed. But when you stream output token-by-token, the structure is often incomplete mid-way. A missing brace or an unclosed string can break the whole parser.</p><h2 class="text-2xl font-bold text-ember mb-2">💥 The Problem</h2><p class="mb-6 leading-relaxed">JSON is strict. If you&#x27;re using OpenAI&#x27;s streaming API and trying to render JSON in real-time, you can&#x27;t do much until the full structure is delivered. That means the UI can&#x27;t update until the model stops thinking — and that&#x27;s frustrating. If your JSON affects how UI is rendered then you have to wait until the end, unlike text where you can stream freely without structural constraints.</p><h2 class="text-2xl font-bold text-ember mb-2">🔧 The Trick: Use YAML</h2><p class="mb-6 leading-relaxed">YAML is more forgiving. It doesn’t require commas, brackets, or perfect nesting at every step. Here&#x27;s what I did:</p><ul class="list-disc list-inside space-y-2 text-gray-400 leading-relaxed mb-6"><li>Let the model output YAML instead of JSON</li><li>Stream it token-by-token</li><li>Try parsing it incrementally using a custom parser</li><li>Merge whatever is valid into a full JSON template</li></ul><p class="mb-6 leading-relaxed">In this code I have used <b>YamlTokenStreamer</b> to simulate token streaming. This class is purely for local testing — when using a real LLM with stream support (like OpenAI), you won’t need it. Just plug the rest of the logic into your streamed tokens, and you&#x27;ll be able to produce fully structured JSON in real time — with `null` values where data is not yet available.</p><h2 class="text-2xl font-bold text-ember mb-2">📦 The Template</h2><div class="relative mb-6 rounded-lg overflow-hidden"><span class="absolute top-2 left-2 text-xs text-gray-300 px-2 py-0.5 rounded">json</span><button class="absolute top-2 right-2 text-xs text-black bg-ember px-2 py-1 rounded hover:bg-orange-500 transition z-10">Copy</button><pre style="color:white;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;font-size:0.9rem;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1.75rem 1.25rem 0.25rem 1.25rem;margin:0.5em 0;overflow:auto;background:transparent"><code class="language-json" style="white-space:pre;color:#d6deeb;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;font-size:1em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">1</span><span class="token" style="color:rgb(199, 146, 234)">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">2</span><span>  </span><span class="token" style="color:rgb(128, 203, 196)">&quot;user&quot;</span><span class="token" style="color:rgb(127, 219, 202)">:</span><span> </span><span class="token" style="color:rgb(199, 146, 234)">{</span><span class="token" style="color:rgb(128, 203, 196)">&quot;id&quot;</span><span class="token" style="color:rgb(127, 219, 202)">:</span><span> </span><span class="token null" style="color:rgb(127, 219, 202)">null</span><span class="token" style="color:rgb(199, 146, 234)">,</span><span> </span><span class="token" style="color:rgb(128, 203, 196)">&quot;name&quot;</span><span class="token" style="color:rgb(127, 219, 202)">:</span><span> </span><span class="token null" style="color:rgb(127, 219, 202)">null</span><span class="token" style="color:rgb(199, 146, 234)">,</span><span> </span><span class="token" style="color:rgb(128, 203, 196)">&quot;roles&quot;</span><span class="token" style="color:rgb(127, 219, 202)">:</span><span> </span><span class="token" style="color:rgb(199, 146, 234)">[</span><span class="token" style="color:rgb(199, 146, 234)">]</span><span class="token" style="color:rgb(199, 146, 234)">}</span><span class="token" style="color:rgb(199, 146, 234)">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">3</span><span>  </span><span class="token" style="color:rgb(128, 203, 196)">&quot;lastLogin&quot;</span><span class="token" style="color:rgb(127, 219, 202)">:</span><span> </span><span class="token null" style="color:rgb(127, 219, 202)">null</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">4</span><span></span><span class="token" style="color:rgb(199, 146, 234)">}</span></code></pre></div><h2 class="text-2xl font-bold text-ember mb-2">📡 Real-Time Merge</h2><div class="relative mb-6 rounded-lg overflow-hidden"><span class="absolute top-2 left-2 text-xs text-gray-300 px-2 py-0.5 rounded">python</span><button class="absolute top-2 right-2 text-xs text-black bg-ember px-2 py-1 rounded hover:bg-orange-500 transition z-10">Copy</button><pre style="color:white;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;font-size:0.9rem;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1.75rem 1.25rem 0.25rem 1.25rem;margin:0.5em 0;overflow:auto;background:transparent"><code class="language-python" style="white-space:pre;color:#d6deeb;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;font-size:1em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">1</span><span class="token" style="color:rgb(130, 170, 255)">buffer</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">=</span><span> </span><span class="token" style="color:rgb(173, 219, 103)">&quot;&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">2</span><span></span><span class="token" style="color:rgb(127, 219, 202)">for</span><span> chunk </span><span class="token" style="color:rgb(127, 219, 202)">in</span><span> openai</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span>ChatCompletion</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span>create</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span class="token" style="color:rgb(199, 146, 234)">,</span><span> stream</span><span class="token" style="color:rgb(127, 219, 202)">=</span><span class="token" style="color:rgb(255, 88, 116)">True</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">3</span><span>    token </span><span class="token" style="color:rgb(127, 219, 202)">=</span><span> chunk</span><span class="token" style="color:rgb(199, 146, 234)">[</span><span class="token" style="color:rgb(173, 219, 103)">&#x27;choices&#x27;</span><span class="token" style="color:rgb(199, 146, 234)">]</span><span class="token" style="color:rgb(199, 146, 234)">[</span><span class="token" style="color:rgb(247, 140, 108)">0</span><span class="token" style="color:rgb(199, 146, 234)">]</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span>delta</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span>get</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span class="token" style="color:rgb(173, 219, 103)">&#x27;content&#x27;</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">4</span><span>    </span><span class="token" style="color:rgb(127, 219, 202)">if</span><span> token</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">5</span><span>        </span><span class="token" style="color:rgb(130, 170, 255)">buffer</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">+=</span><span> token
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">6</span><span>        parsed</span><span class="token" style="color:rgb(199, 146, 234)">,</span><span> _ </span><span class="token" style="color:rgb(127, 219, 202)">=</span><span> try_partial_yaml_parse</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span class="token" style="color:rgb(130, 170, 255)">buffer</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">7</span><span>        merged </span><span class="token" style="color:rgb(127, 219, 202)">=</span><span> merge_yaml_into_template</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span>template</span><span class="token" style="color:rgb(199, 146, 234)">,</span><span> parsed</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">8</span><span>        </span><span class="token" style="color:rgb(127, 219, 202)">print</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span>merged</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>  </span><span class="token" style="color:rgb(99, 119, 119);font-style:italic"># Always structured, even when partial</span></code></pre></div><h2 class="text-2xl font-bold text-ember mb-2">🧠 Bonus: Quote Heuristics</h2><p class="mb-6 leading-relaxed">If parsing fails, the parser tries to append a missing quote `&quot;` at the end of the last line — this fixes many broken outputs where the model stopped mid-string.</p><h2 class="text-2xl font-bold text-ember mb-2">📈 Outcome</h2><p class="mb-6 leading-relaxed">Now <b class="text-ember">YOU</b> can stream LLM output into your UI and render the structure in real-time — safely. Every key exists thanks to the template. Every value updates only when it&#x27;s available. No more crashes due to malformed JSON.</p><h2 class="text-2xl font-bold text-ember mb-2">🏁 Final Thought</h2><p class="mb-6 leading-relaxed">YAML isn&#x27;t just human-friendly — it&#x27;s stream-friendly too. If you&#x27;re building tool-based agents or structured UIs, this simple trick can make a big difference. Don&#x27;t wait for perfect JSON. Start rendering now.</p></div></main></div><script src="/_next/static/chunks/webpack-9edee2920554d0a5.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[15244,[],\"\"]\n3:I[43866,[],\"\"]\n4:I[57033,[],\"ClientPageRoot\"]\n5:I[75929,[\"932\",\"static/chunks/932-8bfdd8b6c3b22a28.js\",\"904\",\"static/chunks/app/blogs/streaming-json/page-19131ed480d1c870.js\"],\"default\"]\n8:I[86213,[],\"OutletBoundary\"]\na:I[86213,[],\"MetadataBoundary\"]\nc:I[86213,[],\"ViewportBoundary\"]\ne:I[34835,[],\"\"]\n:HL[\"/_next/static/css/b42ee275af96bf75.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"5McQakl_Cbp78y2_G-Spt\",\"p\":\"\",\"c\":[\"\",\"blogs\",\"streaming-json\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blogs\",{\"children\":[\"streaming-json\",{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/b42ee275af96bf75.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"base\",null,{\"href\":\"./\"}]}],[\"$\",\"body\",null,{\"className\":\"relative min-h-screen bg-cover bg-center bg-no-repeat bg-fixed\",\"style\":{\"backgroundImage\":\"url('/images/bg-home.png')\"},\"children\":[\"$\",\"div\",null,{\"className\":\"bg-black/70 min-h-screen\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}]]}],{\"children\":[\"blogs\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blogs\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"streaming-json\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blogs\",\"children\",\"streaming-json\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"$L4\",null,{\"Component\":\"$5\",\"searchParams\":{},\"params\":{},\"promises\":[\"$@6\",\"$@7\"]}],null,[\"$\",\"$L8\",null,{\"children\":\"$L9\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"2ihr5FBH81kxGQmDL2OHd\",{\"children\":[[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$e\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"6:{}\n7:{}\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Medhavi Monish\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"AI Blacksmith forging intelligence from scratch\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]]\n"])</script><script>self.__next_f.push([1,"9:null\n"])</script></body></html>